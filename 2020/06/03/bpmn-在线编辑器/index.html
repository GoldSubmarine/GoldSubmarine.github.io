<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="GoldSubmarine"><title>BPMN 在线编辑器 | Submarine</title><link rel="icon" href="https://cdn.jsdelivr.net/gh/goldsubmarine/cdn@master/blog/toucan.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/goldsubmarine/goldsubmarine.github.io@master/css/style.css"><script src="https://cdn.jsdelivr.net/gh/goldsubmarine/goldsubmarine.github.io@master/js/script.js"></script><script src="https://cdn.jsdelivr.net/gh/goldsubmarine/goldsubmarine.github.io@master/js/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/gh/goldsubmarine/goldsubmarine.github.io@master/js/medium-zoom.min.js"></script><meta name="generator" content="Hexo 4.2.1"></head><body><div class="wrapper"><header><nav class="navbar"><div class="container"><div class="navbar-header header-logo"><a href="/">GoldSubmarine&#39;s Blog</a></div><div class="menu navbar-right"><div class="search-box"><div class="search-container"><span class="search-icon"><i class="fa fa-search"></i></span> <input type="input" id="search" autocomplete="off" placeholder="Search..."><div class="search-loader" style="display:none"></div></div><div id="search-result-container"></div></div><a class="menu-item" href="/archives">归档</a> <a class="menu-item" href="/category">分类</a> <a class="menu-item" href="/tag">标签</a> <a class="menu-item" href="/about">关于</a> <input id="switch_default" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div></nav><nav class="navbar-mobile" id="nav-mobile"><div class="container"><div class="navbar-header"><div><a href="/">GoldSubmarine&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a></div><div class="menu-toggle" onclick="mobileBtn()">&#9776; 菜单</div></div><div class="menu" id="mobile-menu"><a class="menu-item" href="/archives">归档</a> <a class="menu-item" href="/category">分类</a> <a class="menu-item" href="/tag">标签</a> <a class="menu-item" href="/about">关于</a></div></div></nav></header><script>var mobileBtn=function(){var e=document.getElementsByClassName("menu-toggle")[0],t=document.getElementById("mobile-menu");e.classList.contains("active")?(e.classList.remove("active"),t.classList.remove("active")):(e.classList.add("active"),t.classList.add("active"))}</script><script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script><meta property="algolia:search" data-application-id="OMMOIEMSAA" data-api-key="054cc564e105734852905d2e17a0640b" data-index-name="github_blog"><script>const algoliaConfig = document.querySelector('meta[property="algolia:search"]').dataset;
    const client = algoliasearch(algoliaConfig.applicationId, algoliaConfig.apiKey);
    const index = client.initIndex(algoliaConfig.indexName);
    let inputSearch = document.getElementById("search");
    let searchResultContainer = document.getElementById("search-result-container");
    let searchTimer;
    inputSearch.oninput = function(ev) {
        clearTimeout(searchTimer);
        searchTimer = setTimeout(function() {
            searchResultContainer.innerHTML = "";
            searchAlgolia();
        }, 300)
    }
    inputSearch.onblur = function() {
        setTimeout(function() {
            searchResultContainer.innerHTML = "";
        }, 500);
    }
    inputSearch.onfocus = function() {
        if(inputSearch.value) {
            searchAlgolia();
        }
    }
    function searchAlgolia() {
        if(!inputSearch.value || !inputSearch.value.trim()) {
            searchResultContainer.innerHTML = "";
            return;
        }
        document.getElementsByClassName('search-loader')[0].style = 'display: block'
        index.search(inputSearch.value.trim(), function(err, content) {
            if(content.hits.length) {
                console.log(content)
                let resultHtml = '<ul class="search-result">';
                let permalinkList = [];
                content.hits.forEach(hit => {
                    if(!permalinkList.includes(hit.permalink)) {
                        resultHtml += `<li><a href="${hit.permalink.replace(/http:\/\/yoursite\.com/, '')}">${hit.title}</a></li>`
                        permalinkList.push(hit.permalink)
                    }
                });
                resultHtml += '</ul>';
                searchResultContainer.innerHTML = resultHtml;
            } else {
                searchResultContainer.innerHTML = "";
            }
            document.getElementsByClassName('search-loader')[0].style = 'display: none'
        });
    }</script><div class="main"><div class="container"><div class="post-toc"><div class="tocbot-list"></div><div class="tocbot-list-menu"><a class="tocbot-toc-expand" onclick="expand_toc()">全部展开</a> <a onclick="go_top()">回到顶部</a> <a onclick="go_bottom()">前往底部</a></div></div><script>function expand_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:6,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","collapse_toc()"),o.innerHTML="Collapse all"}function collapse_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","expand_toc()"),o.innerHTML="Expand all"}function go_top(){window.scrollTo(0,0)}function go_bottom(){window.scrollTo(0,document.body.scrollHeight)}document.ready(function(){tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0})})</script><article class="post-wrap"><header class="post-header"><h1 class="post-title">BPMN 在线编辑器</h1><div class="post-meta">作者: <a itemprop="author" rel="author" href="/">GoldSubmarine</a> <span class="post-time">日期: <a href="#">2020-06-03&nbsp;&nbsp;10:13:00</a></span> <span class="post-category">分类: <a href="/categories/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF/">软件技术</a></span></div></header><div class="post-content"><p>在 Activiti 以前的老版本中有提供一个嵌入后端的流程编辑器的，但是现在的新版本把流程编辑器从中剥离了出来，成为了一个单独的项目，是用 Angular 写的，因为目前我们的项目是基于 vue 的，所以这里使用 Vue + Bpmn.js 搭建了一个流程编辑器。</p><p>这个篇章不会涉及到流程任务的办理，所以只是在前端中画出流程图，然后导出一个 Bpmn 文件。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>首先准备一个 vue 工程，然后安装 bpmn</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add bpmn-js</span><br></pre></td></tr></table></figure><h2 id="创建-Bpmn-建模器"><a href="#创建-Bpmn-建模器" class="headerlink" title="创建 Bpmn 建模器"></a>创建 Bpmn 建模器</h2><p>首先 Bpmn-js 的建模器其实是通过 Canvas 来实现的，我们在 template 中创建一个 div 供给 Bpmn 创建建模器。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 创建一个canvas画布 npmn-js是通过canvas实现绘图的，并设置ref让vue获取到element --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bpmn-canvas"</span> <span class="attr">ref</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>写好了 Html 部分接下来我们来实现 js 部分。要创建建模器我们要使用到 BpmnModeler 这个对象，主要通过创建这个对象创建建模器。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入样式</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"bpmn-js/dist/assets/diagram-js.css"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"bpmn-js/dist/assets/bpmn-font/css/bpmn.css"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"bpmn-js/dist/assets/bpmn-font/css/bpmn-codes.css"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"bpmn-js/dist/assets/bpmn-font/css/bpmn-embedded.css"</span>;</span><br><span class="line"><span class="comment">// 在这里引入一下Bpmn建模器对象</span></span><br><span class="line"><span class="keyword">import</span> BpmnModeler <span class="keyword">from</span> <span class="string">"bpmn-js/lib/Modeler"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      bpmnModeler: <span class="literal">null</span>,</span><br><span class="line">      canvas: <span class="literal">null</span>,</span><br><span class="line">      <span class="comment">// 这部分具体的代码我放到了下面</span></span><br><span class="line">      initTemplate: <span class="string">`略`</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    init() &#123;</span><br><span class="line">      <span class="comment">// 获取画布 element</span></span><br><span class="line">      <span class="keyword">this</span>.canvas = <span class="keyword">this</span>.$refs.canvas;</span><br><span class="line">      <span class="comment">// 创建Bpmn对象</span></span><br><span class="line">      <span class="keyword">this</span>.bpmnModeler = <span class="keyword">new</span> BpmnModeler(&#123;</span><br><span class="line">        <span class="comment">// 设置bpmn的绘图容器为上门获取的画布 element</span></span><br><span class="line">        container: <span class="keyword">this</span>.canvas,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 初始化建模器内容</span></span><br><span class="line">      <span class="keyword">this</span>.initDiagram(<span class="keyword">this</span>.initTemplate);</span><br><span class="line">    &#125;,</span><br><span class="line">    initDiagram(bpmn) &#123;</span><br><span class="line">      <span class="comment">// 将xml导入Bpmn-js建模器</span></span><br><span class="line">      <span class="keyword">this</span>.bpmnModeler.importXML(bpmn, (err) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="keyword">this</span>.$Message.error(<span class="string">"打开模型出错,请确认该模型符合Bpmn2.0规范"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 生命周期钩子，在组件加载完成后调用init函数进行创建初始化Bpmn-js建模器</span></span><br><span class="line">  mounted() &#123;</span><br><span class="line">    <span class="keyword">this</span>.init();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这部份 xml 就是 Bpmn 流程图的模板代码了，这个模板包含了一个开始节点在里面，根据需求可以按照自己需要的创建或者修改模板，当然我不推荐手动修改 xml 代码。创建模板的方式我推荐就是在 Bpmn-js 建模器中来创建一个自己想要的模型，然后导出 xml 或者 bpmn 文件再把文件里面的代码复制出来使用就好。</p><p>在我具体的实际应用以及跟 Activiti7 后端的结合中发现 xml 模板需要注意的一个点是 xml 首部，就是 definitions 标签部分这里引入了很多命名空间，如果你的流程图需要部署到 Activiti 中的话那你要注意必须要引入 Activiti 的命名空间 .<br>   以下模板就是符合 Activiti 使用的 Xml 模板了。若没有引入或者不符合 Activiti 的规范命名空间的话那将会导致模型部署失败。如果模型最终要部署到 Activiti 的话建议基于以下模板修改使用。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">definitions</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns</span>=<span class="string">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:bpmndi</span>=<span class="string">"http://www.omg.org/spec/BPMN/20100524/DI"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:omgdc</span>=<span class="string">"http://www.omg.org/spec/DD/20100524/DC"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:camunda</span>=<span class="string">"http://camunda.org/schema/1.0/bpmn"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsd</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:activiti</span>=<span class="string">"http://activiti.org/bpmn"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">"m1577635100724"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">name</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">  <span class="attr">targetNamespace</span>=<span class="string">"http://www.activiti.org/testm1577635100724"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">process</span> <span class="attr">id</span>=<span class="string">"process"</span> <span class="attr">processType</span>=<span class="string">"None"</span> <span class="attr">isClosed</span>=<span class="string">"false"</span> <span class="attr">isExecutable</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">extensionElements</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">camunda:properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">camunda:property</span> <span class="attr">name</span>=<span class="string">"a"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">camunda:properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">extensionElements</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">startEvent</span> <span class="attr">id</span>=<span class="string">"_2"</span> <span class="attr">name</span>=<span class="string">"start"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">process</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bpmndi:BPMNDiagram</span> <span class="attr">id</span>=<span class="string">"BPMNDiagram_leave"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bpmndi:BPMNPlane</span> <span class="attr">id</span>=<span class="string">"BPMNPlane_leave"</span> <span class="attr">bpmnElement</span>=<span class="string">"leave"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">id</span>=<span class="string">"BPMNShape__2"</span> <span class="attr">bpmnElement</span>=<span class="string">"_2"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">x</span>=<span class="string">"144"</span> <span class="attr">y</span>=<span class="string">"368"</span> <span class="attr">width</span>=<span class="string">"32"</span> <span class="attr">height</span>=<span class="string">"32"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">x</span>=<span class="string">"149"</span> <span class="attr">y</span>=<span class="string">"400"</span> <span class="attr">width</span>=<span class="string">"23"</span> <span class="attr">height</span>=<span class="string">"14"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bpmndi:BPMNLabel</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bpmndi:BPMNPlane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bpmndi:BPMNDiagram</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">definitions</span>&gt;</span></span><br></pre></td></tr></table></figure><p>完成以上的步骤我们完成了建模器的创建，让我们来看看效果。</p><p><img src="https://cdn.jsdelivr.net/gh/goldsubmarine/cdn@master/blog/bpmn-1.png" alt="bpmn-1"></p><h2 id="添加-bpmn-js-properties-panel-面板插件"><a href="#添加-bpmn-js-properties-panel-面板插件" class="headerlink" title="添加 bpmn-js-properties-panel 面板插件"></a>添加 bpmn-js-properties-panel 面板插件</h2><p>Bpmn-js 原本是不支持 Activities 那些自定义值的设置的，需要额外引入插件进行整合。首先先要安装两个插件，分别是 bpmn-js-properties-panel 和 camunda-bpmn-moddle</p><p>bpmn-js-properties-panel 是给建模器提供了属性编辑器，然后 camunda-bpmn-moddle 就是拓展了属性编辑器可以编辑的内容，像 Activitie 的 assignee 这些属性就是要依靠 camunda-bpmn-moddle 来提供编辑的。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// yarn 安装</span><br><span class="line">yarn add bpmn-js-properties-panel</span><br><span class="line">yarn add camunda-bpmn-moddle</span><br><span class="line"></span><br><span class="line">// npm 安装</span><br><span class="line">npm install bpmn-js-properties-panel</span><br><span class="line">npm install camunda-bpmn-moddle</span><br></pre></td></tr></table></figure><p>在 App.vue 里要创建一个 div 给工具栏一个显示的位置。我直接就放 canvas 的下面了</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 工具栏显示的地方 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bpmn-js-properties-panel"</span> <span class="attr">id</span>=<span class="string">"js-properties-panel"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后要导入一下工具栏以及配置一下对工具栏的支持</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 左边工具栏以及编辑节点的样式</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"bpmn-js-properties-panel/dist/assets/bpmn-js-properties-panel.css"</span>;</span><br><span class="line"><span class="comment">// 工具栏相关</span></span><br><span class="line"><span class="keyword">import</span> propertiesProviderModule <span class="keyword">from</span> <span class="string">"bpmn-js-properties-panel/lib/provider/camunda"</span>;</span><br><span class="line"><span class="keyword">import</span> propertiesPanelModule <span class="keyword">from</span> <span class="string">"bpmn-js-properties-panel"</span>;</span><br><span class="line"><span class="keyword">import</span> camundaModdleDescriptor <span class="keyword">from</span> <span class="string">"camunda-bpmn-moddle/resources/camunda"</span>;</span><br></pre></td></tr></table></figure><p>修改后的 init 函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">init() &#123;</span><br><span class="line">  <span class="comment">// 获取画布 element</span></span><br><span class="line">  <span class="keyword">this</span>.canvas = <span class="keyword">this</span>.$refs.canvas;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建Bpmn对象</span></span><br><span class="line">  <span class="keyword">this</span>.bpmnModeler = <span class="keyword">new</span> BpmnModeler(&#123;</span><br><span class="line">    <span class="comment">// 设置bpmn的绘图容器为上门获取的画布 element</span></span><br><span class="line">    container: <span class="keyword">this</span>.canvas,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加入工具栏支持</span></span><br><span class="line">    propertiesPanel: &#123;</span><br><span class="line">      parent: <span class="string">"#js-properties-panel"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    additionalModules: [propertiesProviderModule, propertiesPanelModule],</span><br><span class="line">    moddleExtensions: &#123;</span><br><span class="line">      camunda: camundaModdleDescriptor</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.createNewDiagram(<span class="keyword">this</span>.bpmnTemplate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果如下</p><p><img src="https://cdn.jsdelivr.net/gh/goldsubmarine/cdn@master/blog/bpmn-2.jpg" alt="bpmn-2"></p><h2 id="实现新建、导入，导出操作"><a href="#实现新建、导入，导出操作" class="headerlink" title="实现新建、导入，导出操作"></a>实现新建、导入，导出操作</h2><p>实现这些功能我们先把按键和样式写上,以及给它们加上对应的点击事件, 我这里使用了 Element 组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"action"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 关于打开文件的这个我使用了Element的文件上传组件，在上传前钩子获取到文件然后读取文件内容 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-upload</span> <span class="attr">class</span>=<span class="string">"upload-demo"</span> <span class="attr">:before-upload</span>=<span class="string">"openBpmn"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">icon</span>=<span class="string">"el-icon-folder-opened"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"new"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">icon</span>=<span class="string">"el-icon-circle-plus"</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">"newDiagram"</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">icon</span>=<span class="string">"el-icon-download"</span> @<span class="attr">click</span>=<span class="string">"downloadBpmn"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">icon</span>=<span class="string">"el-icon-picture"</span> @<span class="attr">click</span>=<span class="string">"downloadSvg"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>大概的效果是这样子</p><p><img src="https://cdn.jsdelivr.net/gh/goldsubmarine/cdn@master/blog/bpmn-3.jpg" alt="bpmn-3"></p><p>具体看下述完整代码</p><h2 id="汉化"><a href="#汉化" class="headerlink" title="汉化"></a>汉化</h2><p>对于这个汉化文件我是在码云上找到了一位大佬翻译好的文件，<a href="https://gitee.com/polarloves/bpmn-js/tree/master/app/customTranslate" target="_blank" rel="noopener">链接</a> 里面有两个文件 translationsGerman.js 和 customTranslate.js，其中 translationsGerman.js 这个文件是翻译好的文本配置，customTranslate.js 的话就是汉化器了，它会按照获取到编辑器原本的配置对比 translationsGerman.js 中的配置然后进行替换操作，将相关英文替换为中文文本。</p><p>具体看下述完整代码</p><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 参考：https:&#x2F;&#x2F;github.com&#x2F;winily&#x2F;bpmn-demo --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-dialog</span><br><span class="line">    title&#x3D;&quot;流程设计&quot;</span><br><span class="line">    :visible.sync&#x3D;&quot;dialogVisible&quot;</span><br><span class="line">    fullscreen</span><br><span class="line">    :close-on-click-modal&#x3D;&quot;false&quot;</span><br><span class="line">    @closed&#x3D;&quot;$emit(&#39;close&#39;)&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;position: relative;&quot;&gt;</span><br><span class="line">      &lt;!-- 创建一个canvas画布 npmn-js是通过canvas实现绘图的，并设置ref让vue获取到element --&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;bpmn-container&quot;&gt;</span><br><span class="line">        &lt;div ref&#x3D;&quot;canvas&quot; class&#x3D;&quot;bpmn-canvas&quot; &#x2F;&gt;</span><br><span class="line">        &lt;!-- 工具栏显示的地方 --&gt;</span><br><span class="line">        &lt;div id&#x3D;&quot;js-properties-panel&quot; class&#x3D;&quot;bpmn-js-properties-panel&quot; &#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 把操作按钮写在这里面 --&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;action&quot;&gt;</span><br><span class="line">        &lt;el-upload action class&#x3D;&quot;upload-demo&quot; :before-upload&#x3D;&quot;openBpmn&quot;&gt;</span><br><span class="line">          &lt;el-button icon&#x3D;&quot;el-icon-folder-opened&quot; &#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;el-upload&gt;</span><br><span class="line">        &lt;el-button class&#x3D;&quot;new&quot; icon&#x3D;&quot;el-icon-circle-plus&quot; @click&#x3D;&quot;newDiagram&quot; &#x2F;&gt;</span><br><span class="line">        &lt;el-button icon&#x3D;&quot;el-icon-download&quot; @click&#x3D;&quot;downloadBpmn&quot; &#x2F;&gt;</span><br><span class="line">        &lt;el-button icon&#x3D;&quot;el-icon-picture&quot; @click&#x3D;&quot;downloadSvg&quot; &#x2F;&gt;</span><br><span class="line">        &lt;a ref&#x3D;&quot;downloadLink&quot; hidden &#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;el-dialog&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &quot;bpmn-js&#x2F;dist&#x2F;assets&#x2F;diagram-js.css&quot;;</span><br><span class="line">import &quot;bpmn-js&#x2F;dist&#x2F;assets&#x2F;bpmn-font&#x2F;css&#x2F;bpmn.css&quot;;</span><br><span class="line">import &quot;bpmn-js&#x2F;dist&#x2F;assets&#x2F;bpmn-font&#x2F;css&#x2F;bpmn-codes.css&quot;;</span><br><span class="line">import &quot;bpmn-js&#x2F;dist&#x2F;assets&#x2F;bpmn-font&#x2F;css&#x2F;bpmn-embedded.css&quot;;</span><br><span class="line"></span><br><span class="line">import BpmnModeler from &quot;bpmn-js&#x2F;lib&#x2F;Modeler&quot;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 左边工具栏以及编辑节点的样式</span><br><span class="line">import &quot;bpmn-js-properties-panel&#x2F;dist&#x2F;assets&#x2F;bpmn-js-properties-panel.css&quot;;</span><br><span class="line">&#x2F;&#x2F; 工具栏相关</span><br><span class="line">import propertiesProviderModule from &quot;bpmn-js-properties-panel&#x2F;lib&#x2F;provider&#x2F;camunda&quot;;</span><br><span class="line">import propertiesPanelModule from &quot;bpmn-js-properties-panel&quot;;</span><br><span class="line">import camundaModdleDescriptor from &quot;camunda-bpmn-moddle&#x2F;resources&#x2F;camunda&quot;;</span><br><span class="line">import camundaExtensionModule from &quot;camunda-bpmn-moddle&#x2F;lib&quot;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 汉化</span><br><span class="line">import customTranslate from &quot;.&#x2F;translate&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      dialogVisible: true,</span><br><span class="line">      bpmnModeler: null,</span><br><span class="line">      canvas: null,</span><br><span class="line">      bpmnTemplate: &#96;</span><br><span class="line">          &lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">          &lt;definitions</span><br><span class="line">              xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.omg.org&#x2F;spec&#x2F;BPMN&#x2F;20100524&#x2F;MODEL&quot;</span><br><span class="line">              xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">              xmlns:bpmndi&#x3D;&quot;http:&#x2F;&#x2F;www.omg.org&#x2F;spec&#x2F;BPMN&#x2F;20100524&#x2F;DI&quot;</span><br><span class="line">              xmlns:omgdc&#x3D;&quot;http:&#x2F;&#x2F;www.omg.org&#x2F;spec&#x2F;DD&#x2F;20100524&#x2F;DC&quot;</span><br><span class="line">              xmlns:camunda&#x3D;&quot;http:&#x2F;&#x2F;camunda.org&#x2F;schema&#x2F;1.0&#x2F;bpmn&quot;</span><br><span class="line">              xmlns:xsd&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema&quot;</span><br><span class="line">              xmlns:activiti&#x3D;&quot;http:&#x2F;&#x2F;activiti.org&#x2F;bpmn&quot;</span><br><span class="line">              id&#x3D;&quot;m1577635100724&quot;</span><br><span class="line">              name&#x3D;&quot;&quot;</span><br><span class="line">              targetNamespace&#x3D;&quot;http:&#x2F;&#x2F;www.activiti.org&#x2F;testm1577635100724&quot;</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;process id&#x3D;&quot;process&quot; processType&#x3D;&quot;None&quot; isClosed&#x3D;&quot;false&quot; isExecutable&#x3D;&quot;true&quot;&gt;</span><br><span class="line">              &lt;extensionElements&gt;</span><br><span class="line">                &lt;camunda:properties&gt;</span><br><span class="line">                  &lt;camunda:property name&#x3D;&quot;a&quot; value&#x3D;&quot;1&quot; &#x2F;&gt;</span><br><span class="line">                &lt;&#x2F;camunda:properties&gt;</span><br><span class="line">              &lt;&#x2F;extensionElements&gt;</span><br><span class="line">              &lt;startEvent id&#x3D;&quot;_2&quot; name&#x3D;&quot;start&quot; &#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;process&gt;</span><br><span class="line">            &lt;bpmndi:BPMNDiagram id&#x3D;&quot;BPMNDiagram_leave&quot;&gt;</span><br><span class="line">              &lt;bpmndi:BPMNPlane id&#x3D;&quot;BPMNPlane_leave&quot; bpmnElement&#x3D;&quot;leave&quot;&gt;</span><br><span class="line">                &lt;bpmndi:BPMNShape id&#x3D;&quot;BPMNShape__2&quot; bpmnElement&#x3D;&quot;_2&quot;&gt;</span><br><span class="line">                  &lt;omgdc:Bounds x&#x3D;&quot;144&quot; y&#x3D;&quot;368&quot; width&#x3D;&quot;32&quot; height&#x3D;&quot;32&quot; &#x2F;&gt;</span><br><span class="line">                  &lt;bpmndi:BPMNLabel&gt;</span><br><span class="line">                    &lt;omgdc:Bounds x&#x3D;&quot;149&quot; y&#x3D;&quot;400&quot; width&#x3D;&quot;23&quot; height&#x3D;&quot;14&quot; &#x2F;&gt;</span><br><span class="line">                  &lt;&#x2F;bpmndi:BPMNLabel&gt;</span><br><span class="line">                &lt;&#x2F;bpmndi:BPMNShape&gt;</span><br><span class="line">              &lt;&#x2F;bpmndi:BPMNPlane&gt;</span><br><span class="line">            &lt;&#x2F;bpmndi:BPMNDiagram&gt;</span><br><span class="line">          &lt;&#x2F;definitions&gt;</span><br><span class="line">      &#96;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    this.$nextTick().then(() &#x3D;&gt; this.init());</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    newDiagram() &#123;</span><br><span class="line">      this.createNewDiagram(this.bpmnTemplate);</span><br><span class="line">    &#125;,</span><br><span class="line">    async downloadBpmn() &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        const &#123; xml &#125; &#x3D; await this.bpmnModeler.saveXML(&#123; format: true &#125;);</span><br><span class="line">        &#x2F;&#x2F; 获取文件名</span><br><span class="line">        const name &#x3D; &#96;$&#123;this.getFilename(xml)&#125;.bpmn&#96;;</span><br><span class="line">        &#x2F;&#x2F; 将文件名以及数据交给下载方法</span><br><span class="line">        this.download(&#123; name: name, data: xml &#125;);</span><br><span class="line">      &#125; catch (err) &#123;</span><br><span class="line">        console.log(&quot;error rendering&quot;, err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    async downloadSvg() &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        const &#123; xml &#125; &#x3D; await this.bpmnModeler.saveXML(&#123; format: true &#125;);</span><br><span class="line">        &#x2F;&#x2F; 获取文件名</span><br><span class="line">        const name &#x3D; &#96;$&#123;this.getFilename(xml)&#125;.svg&#96;;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 从建模器画布中提取svg图形标签</span><br><span class="line">        let context &#x3D; &quot;&quot;;</span><br><span class="line">        const djsGroupAll &#x3D; this.$refs.canvas.querySelectorAll(&quot;.djs-group&quot;);</span><br><span class="line">        for (const item of djsGroupAll) &#123;</span><br><span class="line">          context +&#x3D; item.innerHTML;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; 获取svg的基本数据，长宽高</span><br><span class="line">        const viewport &#x3D; this.$refs.canvas.querySelector(&quot;.viewport&quot;).getBBox();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 将标签和数据拼接成一个完整正常的svg图形</span><br><span class="line">        const svg &#x3D; &#96;</span><br><span class="line">            &lt;svg</span><br><span class="line">              xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&quot;</span><br><span class="line">              xmlns:xlink&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;1999&#x2F;xlink&quot;</span><br><span class="line">              width&#x3D;&quot;$&#123;viewport.width&#125;&quot;</span><br><span class="line">              height&#x3D;&quot;$&#123;viewport.height&#125;&quot;</span><br><span class="line">              viewBox&#x3D;&quot;$&#123;viewport.x&#125; $&#123;viewport.y&#125; $&#123;viewport.width&#125; $&#123;viewport.height&#125;&quot;</span><br><span class="line">              version&#x3D;&quot;1.1&quot;</span><br><span class="line">              &gt;</span><br><span class="line">              $&#123;context&#125;</span><br><span class="line">            &lt;&#x2F;svg&gt;</span><br><span class="line">          &#96;;</span><br><span class="line">        &#x2F;&#x2F; 将文件名以及数据交给下载方法</span><br><span class="line">        this.download(&#123; name: name, data: svg &#125;);</span><br><span class="line">      &#125; catch (err) &#123;</span><br><span class="line">        console.log(&quot;error rendering&quot;, err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    openBpmn(file) &#123;</span><br><span class="line">      const reader &#x3D; new FileReader();</span><br><span class="line">      &#x2F;&#x2F; 读取File对象中的文本信息，编码格式为UTF-8</span><br><span class="line">      reader.readAsText(file, &quot;utf-8&quot;);</span><br><span class="line">      reader.onload &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">        &#x2F;&#x2F; 读取完毕后将文本信息导入到Bpmn建模器</span><br><span class="line">        this.createNewDiagram(reader.result);</span><br><span class="line">      &#125;;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;,</span><br><span class="line">    getFilename(xml) &#123;</span><br><span class="line">      const start &#x3D; xml.indexOf(&quot;process&quot;);</span><br><span class="line">      let filename &#x3D; xml.substr(start, xml.indexOf(&quot;&gt;&quot;));</span><br><span class="line">      filename &#x3D; filename.substr(filename.indexOf(&quot;id&quot;) + 4);</span><br><span class="line">      filename &#x3D; filename.substr(0, filename.indexOf(&#39;&quot;&#39;));</span><br><span class="line">      return filename;</span><br><span class="line">    &#125;,</span><br><span class="line">    download(&#123; name &#x3D; &quot;diagram.bpmn&quot;, data &#125;) &#123;</span><br><span class="line">      &#x2F;&#x2F; 这里就获取到了之前设置的隐藏链接</span><br><span class="line">      const downloadLink &#x3D; this.$refs.downloadLink;</span><br><span class="line">      &#x2F;&#x2F; 把数据转换为URI，下载要用到的</span><br><span class="line">      const encodedData &#x3D; encodeURIComponent(data);</span><br><span class="line"></span><br><span class="line">      if (data) &#123;</span><br><span class="line">        &#x2F;&#x2F; 将数据给到链接</span><br><span class="line">        downloadLink.href &#x3D;</span><br><span class="line">          &quot;data:application&#x2F;bpmn20-xml;charset&#x3D;UTF-8,&quot; + encodedData;</span><br><span class="line">        &#x2F;&#x2F; 设置文件名</span><br><span class="line">        downloadLink.download &#x3D; name;</span><br><span class="line">        &#x2F;&#x2F; 触发点击事件开始下载</span><br><span class="line">        downloadLink.click();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    async init() &#123;</span><br><span class="line">      &#x2F;&#x2F; 获取画布 element</span><br><span class="line">      this.canvas &#x3D; this.$refs.canvas;</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; 将汉化包装成一个模块</span><br><span class="line">      const customTranslateModule &#x3D; &#123;</span><br><span class="line">        translate: [&quot;value&quot;, customTranslate],</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; 创建Bpmn对象</span><br><span class="line">      this.bpmnModeler &#x3D; new BpmnModeler(&#123;</span><br><span class="line">        &#x2F;&#x2F; 设置bpmn的绘图容器为上门获取的画布 element</span><br><span class="line">        container: this.canvas,</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 加入工具栏支持</span><br><span class="line">        propertiesPanel: &#123;</span><br><span class="line">          parent: &quot;#js-properties-panel&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        additionalModules: [</span><br><span class="line">          &#x2F;&#x2F; 工具栏模块</span><br><span class="line">          propertiesProviderModule,</span><br><span class="line">          propertiesPanelModule,</span><br><span class="line">          &#x2F;&#x2F; camunda</span><br><span class="line">          camundaExtensionModule,</span><br><span class="line">          &#x2F;&#x2F; 汉化模块</span><br><span class="line">          customTranslateModule,</span><br><span class="line">        ],</span><br><span class="line">        moddleExtensions: &#123;</span><br><span class="line">          camunda: camundaModdleDescriptor,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      await this.createNewDiagram(this.bpmnTemplate);</span><br><span class="line">    &#125;,</span><br><span class="line">    async createNewDiagram(bpmn) &#123;</span><br><span class="line">      &#x2F;&#x2F; 将字符串转换成图显示出来;</span><br><span class="line">      try &#123;</span><br><span class="line">        await this.bpmnModeler.importXML(bpmn);</span><br><span class="line">      &#125; catch (err) &#123;</span><br><span class="line">        console.log(</span><br><span class="line">          &quot;打开模型出错,请确认该模型符合Bpmn2.0规范&quot;,</span><br><span class="line">          err.message,</span><br><span class="line">          err.warnings</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.bpmn-container &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: calc(100vh - 114px);</span><br><span class="line">  display: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.bpmn-canvas &#123;</span><br><span class="line">  width: calc(100% - 300px);</span><br><span class="line">  height: calc(100vh - 114px);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.bpmn-js-properties-panel &#123;</span><br><span class="line">  width: 320px;</span><br><span class="line">  height: inherit;</span><br><span class="line">  overflow-y: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.action &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  bottom: 20px;</span><br><span class="line">  left: 20px;</span><br><span class="line">  display: flex;</span><br><span class="line">&#125;</span><br><span class="line">.upload-demo &#123;</span><br><span class="line">  margin-right: 10px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure><blockquote><p>参考链接：<a href="https://github.com/winily/bpmn-demo" target="_blank" rel="noopener">https://github.com/winily/bpmn-demo</a></p></blockquote></div><section class="post-copyright"><p class="copyright-item"><span>作者:</span> <span>GoldSubmarine</span></p><p class="copyright-item"><span>原文地址:</span> <span><a href="https://goldsubmarine.github.io/2020/06/03/bpmn-%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/">https://goldsubmarine.github.io/2020/06/03/bpmn-%E5%9C%A8%E7%BA%BF%E7%BC%96%E8%BE%91%E5%99%A8/</a></span></p><p class="copyright-item"><span>许可:</span> <span>Copyright (c) 2022 <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC-BY-NC-4.0</a> LICENSE</span></p></section><section class="post-tags"><div><span>Tag(s):</span> <span class="tag"><a href="/tags/Activiti/"># Activiti</a></span></div><div><a href="javascript:window.history.back();">back</a> <span>·</span> <a href="/">home</a></div></section><section class="post-nav"><a class="prev" rel="prev" href="/2020/06/03/activiti-%E5%85%A5%E9%97%A8/">Activiti 入门</a> <a class="next" rel="next" href="/2020/05/31/netty-%E5%88%9D%E6%8E%A2/">Netty 初探</a></section></article></div><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.5.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.5.2/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
        clientID: '4eeae5fd36daf5647141',
        clientSecret: 'be865c2d10e4a71994120646ff80bdaef656b9be',
        repo: 'GoldSubmarine.github.io',
        owner: 'GoldSubmarine',
        admin: 'GoldSubmarine',
        id: md5(location.pathname),
        labels: 'Gitalk'.split(',').filter(l => l),
        perPage: 10,
        pagerDirection: 'last',
        createIssueManually: true,
        distractionFreeMode: false
      })
      gitalk.render('gitalk-container')</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script></div><footer id="footer" class="footer"><div class="copyright"><span>© GoldSubmarine | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span></div></footer></div></body></html>