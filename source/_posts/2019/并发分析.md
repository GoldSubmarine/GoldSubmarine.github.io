---
title: 并发分析
date: 2019-03-07 16:32:12
tags: java
---

一台电脑有很多程序在运行，也就有很多进程，一台单核的计算机给每个进程分配一定的时间（时间片）运行，然后快速切换到写一个进程，因为切换的很快，所以人感受不到程序的暂停，下面看一下时间片是怎么分配的：

>时间片由操作系统内核的调度程序分配给每个进程。首先，内核会给每个进程分配相等的初始时间片，然后每个进程轮番地执行相应的时间，当所有进程都处于时间片耗尽的状态时，内核会重新为每个进程计算并分配时间片，如此往复。  
>
>尽管初始时间片基本相等，但是后续被分配到的时间片长短并不是相等的，系统通过测量进程处于“睡眠”和“正在运行”状态的时间长短来计算每个进程的交互性，交互性和每个进程预设的静态优先级（Nice值）的叠加即是动态优先级，最后动态优先级按比例缩放就是要分配给那个进程时间片的长短。  
>
>--------维基百科

在操作系统中，有三个重要的概念：进程、线程、协程。

进程：当我们运行一个程序的时候，比如你的IDE或者QQ等，操作系统会为这个程序创建一个进程，这个进程包含了运行这个程序所需的各种资源，可以说它是一个容器，是属于这个程序的工作空间，比如它里面有内存空间、文件句柄、设备和线程等等。

线程：线程是一个执行的空间，比如要下载一个文件，访问一次网络等等。线程会被操作系统调用，来在不同的处理器上运行编写的代码任务，这个处理器不一定是该程序进程所在的处理。调度是操作系统负责的。线程是 **轻量级** 进程，他们是可以并行运行的，并且共享地使用他们所属进程的地址空间资源，比如：内存空间或其他资源

协程：

上下文切换的开销：线程是由CPU进行调度的，CPU的一个时间片内只执行一个线程上下文内的线程，当CPU由执行线程A切换到执行线程B的过程中会发生一些列的操作，这些操作主要有”保存线程A的执行现场“然后”载入线程B的执行现场”，这个过程称之为“上下文切换（context switch）”,这个上下文切换过程并不廉价，如果没有必要，应该尽量减少上下文切换的发生。

https://www.zhihu.com/question/52616541

https://infoq.cn/article/2015/06/nginx-design-performance-scale-

https://www.flysnow.org/2017/04/11/go-in-action-go-goroutine.html