<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="GoldSubmarine"><title>ansible模块 | Submarine</title><link rel="icon" href="https://cdn.jsdelivr.net/gh/goldsubmarine/cdn@master/blog/toucan.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/goldsubmarine/goldsubmarine.github.io@master/css/style.css"><script src="https://cdn.jsdelivr.net/gh/goldsubmarine/goldsubmarine.github.io@master/js/script.js"></script><script src="https://cdn.jsdelivr.net/gh/goldsubmarine/goldsubmarine.github.io@master/js/tocbot.min.js"></script><meta name="generator" content="Hexo 4.2.1"></head><body><div class="wrapper"><header><nav class="navbar"><div class="container"><div class="navbar-header header-logo"><a href="/">GoldSubmarine&#39;s Blog</a></div><div class="menu navbar-right"><div class="search-box"><div class="search-container"><span class="search-icon"><i class="fa fa-search"></i></span> <input type="input" id="search" autocomplete="off" placeholder="Search..."><div class="search-loader" style="display:none"></div></div><div id="search-result-container"></div></div><a class="menu-item" href="/archives">归档</a> <a class="menu-item" href="/category">分类</a> <a class="menu-item" href="/tag">标签</a> <a class="menu-item" href="/about">关于</a> <input id="switch_default" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div></nav><nav class="navbar-mobile" id="nav-mobile"><div class="container"><div class="navbar-header"><div><a href="/">GoldSubmarine&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a></div><div class="menu-toggle" onclick="mobileBtn()">&#9776; 菜单</div></div><div class="menu" id="mobile-menu"><a class="menu-item" href="/archives">归档</a> <a class="menu-item" href="/category">分类</a> <a class="menu-item" href="/tag">标签</a> <a class="menu-item" href="/about">关于</a></div></div></nav></header><script>var mobileBtn=function(){var e=document.getElementsByClassName("menu-toggle")[0],t=document.getElementById("mobile-menu");e.classList.contains("active")?(e.classList.remove("active"),t.classList.remove("active")):(e.classList.add("active"),t.classList.add("active"))}</script><script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script><meta property="algolia:search" data-application-id="OMMOIEMSAA" data-api-key="054cc564e105734852905d2e17a0640b" data-index-name="github_blog"><script>const algoliaConfig = document.querySelector('meta[property="algolia:search"]').dataset;
    const client = algoliasearch(algoliaConfig.applicationId, algoliaConfig.apiKey);
    const index = client.initIndex(algoliaConfig.indexName);
    let inputSearch = document.getElementById("search");
    let searchResultContainer = document.getElementById("search-result-container");
    let searchTimer;
    inputSearch.oninput = function(ev) {
        clearTimeout(searchTimer);
        searchTimer = setTimeout(function() {
            searchResultContainer.innerHTML = "";
            searchAlgolia();
        }, 300)
    }
    inputSearch.onblur = function() {
        setTimeout(function() {
            searchResultContainer.innerHTML = "";
        }, 500);
    }
    inputSearch.onfocus = function() {
        if(inputSearch.value) {
            searchAlgolia();
        }
    }
    function searchAlgolia() {
        if(!inputSearch.value || !inputSearch.value.trim()) {
            searchResultContainer.innerHTML = "";
            return;
        }
        document.getElementsByClassName('search-loader')[0].style = 'display: block'
        index.search(inputSearch.value.trim(), function(err, content) {
            if(content.hits.length) {
                console.log(content)
                let resultHtml = '<ul class="search-result">';
                let permalinkList = [];
                content.hits.forEach(hit => {
                    if(!permalinkList.includes(hit.permalink)) {
                        resultHtml += `<li><a href="${hit.permalink.replace(/http:\/\/yoursite\.com/, '')}">${hit.title}</a></li>`
                        permalinkList.push(hit.permalink)
                    }
                });
                resultHtml += '</ul>';
                searchResultContainer.innerHTML = resultHtml;
            } else {
                searchResultContainer.innerHTML = "";
            }
            document.getElementsByClassName('search-loader')[0].style = 'display: none'
        });
    }</script><div class="main"><div class="container"><div class="post-toc"><div class="tocbot-list"></div><div class="tocbot-list-menu"><a class="tocbot-toc-expand" onclick="expand_toc()">全部展开</a> <a onclick="go_top()">回到顶部</a> <a onclick="go_bottom()">前往底部</a></div></div><script>function expand_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:6,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","collapse_toc()"),o.innerHTML="Collapse all"}function collapse_toc(){var o=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0}),o.setAttribute("onclick","expand_toc()"),o.innerHTML="Expand all"}function go_top(){window.scrollTo(0,0)}function go_bottom(){window.scrollTo(0,document.body.scrollHeight)}document.ready(function(){tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0})})</script><article class="post-wrap"><header class="post-header"><h1 class="post-title">ansible模块</h1><div class="post-meta">作者: <a itemprop="author" rel="author" href="/">GoldSubmarine</a> <span class="post-time">日期: <a href="#">2019-08-10&nbsp;&nbsp;17:51:45</a></span> <span class="post-category">分类: <a href="/categories/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF/">软件技术</a></span></div></header><div class="post-content"><p>在基本概念中我们已经使用过 ping 模块，ansible 还提供了很多其他模块供我们使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible-doc -l;  <span class="comment"># 查看所有的ansible模块</span></span><br><span class="line">ansible -s ping;  <span class="comment"># 查看某个模块的使用方法</span></span><br><span class="line">ansible -s fetch;  <span class="comment"># 查看某个模块的使用方法</span></span><br></pre></td></tr></table></figure><p>我们以 fetch 模块为例，示范如何使用模块</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ansible-doc -s fetch</span><br><span class="line"></span><br><span class="line">- name: Fetch files from remote nodes</span><br><span class="line">  fetch:</span><br><span class="line">      dest: <span class="comment"># (required) A directory to save the file into. For example, if the `dest' directory is `/backup' a `src' file named `/etc/profile' on host `host.example.com', would be saved into `/backup/host.example.com/etc/profile'. The host name is based on the inventory name.</span></span><br><span class="line">      fail_on_missing: <span class="comment"># When set to `yes', the task will fail if the remote file cannot be read for any reason. Prior to Ansible 2.5, setting this would only fail if the source file was missing. The default was changed to `yes' in Ansible 2.5.</span></span><br><span class="line">      flat: <span class="comment"># Allows you to override the default behavior of appending hostname/path/to/file to the destination. If `dest' ends with '/', it will use the basename of the source file, similar to the copy module. Obviously this is only handy if the filenames are unique.</span></span><br><span class="line">      src: <span class="comment"># (required) The file on the remote system to fetch. This `must' be a file, not a directory. Recursive fetching may be supported in a later release.</span></span><br><span class="line">      validate_checksum: <span class="comment"># Verify that the source and destination checksums match after the files are fetched.</span></span><br></pre></td></tr></table></figure><p>查看 fetch 模块的文档，其中 dest 和 src 是必填项，src 指远程主机的文件位置，dest 为存放到当前 ansible 主机的位置。</p><p>远程机器的配置如下：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">all:</span></span><br><span class="line">  <span class="attr">children:</span></span><br><span class="line">    <span class="attr">vps:</span></span><br><span class="line">      <span class="attr">hosts:</span></span><br><span class="line">        <span class="attr">192.168.1.100:</span></span><br><span class="line">          <span class="attr">ansible_port:</span> <span class="number">2</span></span><br><span class="line">          <span class="attr">ansible_user:</span> <span class="string">root</span></span><br><span class="line">          <span class="attr">ansible_ssh_pass:</span> <span class="string">abcd</span></span><br><span class="line">        <span class="attr">server101:</span></span><br><span class="line">          <span class="attr">ansible_host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span></span><br><span class="line">          <span class="attr">ansible_port:</span> <span class="number">22</span></span><br><span class="line">          <span class="attr">ansible_user:</span> <span class="string">root</span></span><br><span class="line">          <span class="attr">ansible_ssh_pass:</span> <span class="string">abcd</span></span><br></pre></td></tr></table></figure><p>执行下载受控主机文件的命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ ansible all -m fetch -a <span class="string">"src=/root/.bash_history dest=/root/fetch/"</span></span><br><span class="line"></span><br><span class="line">144.34.209.243 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"checksum"</span>: <span class="string">"d2146f6c3efe7a68374bdfe6ff65a5bc924b2586"</span>,</span><br><span class="line">    <span class="string">"dest"</span>: <span class="string">"/root/fetch/192.168.1.100/root/.bash_history"</span>,</span><br><span class="line">    <span class="string">"md5sum"</span>: <span class="string">"fa817f141afae86398d20d56572e7694"</span>,</span><br><span class="line">    <span class="string">"remote_checksum"</span>: <span class="string">"d2146f6c3efe7a68374bdfe6ff65a5bc924b2586"</span>,</span><br><span class="line">    <span class="string">"remote_md5sum"</span>: null</span><br><span class="line">&#125;</span><br><span class="line">bwg | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"checksum"</span>: <span class="string">"9777a9dd8eab4343d6f242d913b86fd8bfa60606"</span>,</span><br><span class="line">    <span class="string">"dest"</span>: <span class="string">"/root/fetch/server101/root/.bash_history"</span>,</span><br><span class="line">    <span class="string">"md5sum"</span>: <span class="string">"90b6cfedcbf109d7607bcee27b83910b"</span>,</span><br><span class="line">    <span class="string">"remote_checksum"</span>: <span class="string">"9777a9dd8eab4343d6f242d913b86fd8bfa60606"</span>,</span><br><span class="line">    <span class="string">"remote_md5sum"</span>: null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 <code>-a</code> 指定模块的参数，以上打印出的文字是黄色的，并且从 dest 可以看到 ansible 按主机的不同进行了分类。</p><p>如果再次执行<code>ansible all -m fetch -a &quot;src=/root/.bash_history dest=/root/fetch/&quot;</code>，打印出的文字是绿色的，并且<code>changed: false</code>，表示已经和远程主机完全一样，不需要再次拉取。</p><h2 id="常用模块"><a href="#常用模块" class="headerlink" title="常用模块"></a>常用模块</h2><ul><li><strong>copy 模块</strong>：将 ansible 主机上的文件拷贝到远程主机中</li><li><strong>file 模块</strong>：完成一些对文件的基本操作，比如，创建文件或目录、删除文件或目录、修改文件权限等</li><li><strong>blockinfile 模块</strong>：在指定的文件中插入”一段文本”，这段文本是被标记过的，换句话说就是，我们在这段文本上做了记号，以便在以后的操作中可以通过”标记”找到这段文本，然后修改或者删除它</li><li><strong>lineinfile 模块</strong>：确保”某一行文本”存在于指定的文件中，或者确保从文件中删除指定的”文本”（即确保指定的文本不存在于文件中），还可以根据正则表达式，替换”某一行文本”</li><li><strong>find模块</strong>：在远程主机中查找符合条件的文件，就像find命令一样</li><li><strong>replace模块</strong>：可以根据我们指定的正则表达式替换文件中的字符串，文件中所有被正则匹配到的字符串都会被替换</li><li><strong>command模块</strong>：在远程主机上执行命令</li><li><strong>shell模块</strong>：在远程主机上执行命令，与command模块不同的是，shell模块在远程主机中执行命令时，会经过远程主机上的/bin/sh程序处理</li><li><strong>script模块</strong>：在远程主机上执行ansible主机上的脚本，也就是说，脚本一直存在于ansible主机本地，不需要手动拷贝到远程主机后再执行</li><li><strong>cron模块</strong>：管理远程主机中的计划任务，功能相当于crontab命令</li><li><strong>service模块</strong>：管理远程主机上的服务，比如，启动或停止远程主机中的nginx服务</li><li><strong>user模块</strong>：管理远程主机上的用户，比如创建用户、修改用户、删除用户、为用户创建密钥对等操作</li><li><strong>group模块</strong>：管理远程主机上的组</li><li><strong>yum_repository模块</strong>：管理远程主机上的yum仓库</li><li><strong>yum模块</strong>：在远程主机上通过yum源管理软件包</li></ul></div><section class="post-copyright"><p class="copyright-item"><span>作者:</span> <span>GoldSubmarine</span></p><p class="copyright-item"><span>原文地址:</span> <span><a href="https://goldsubmarine.github.io/2019/08/10/ansible%E6%A8%A1%E5%9D%97/">https://goldsubmarine.github.io/2019/08/10/ansible%E6%A8%A1%E5%9D%97/</a></span></p><p class="copyright-item"><span>许可:</span> <span>Copyright (c) 2022 <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC-BY-NC-4.0</a> LICENSE</span></p></section><section class="post-tags"><div><span>Tag(s):</span> <span class="tag"><a href="/tags/ansible/"># ansible</a></span></div><div><a href="javascript:window.history.back();">back</a> <span>·</span> <a href="/">home</a></div></section><section class="post-nav"><a class="prev" rel="prev" href="/2019/08/16/lombok-%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/">Lombok 踩坑记录</a> <a class="next" rel="next" href="/2019/08/10/api%E8%AE%BE%E8%AE%A1%E7%9A%84%E6%84%9F%E6%83%B3/">API设计的感想</a></section></article></div><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.5.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.5.2/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
        clientID: '4eeae5fd36daf5647141',
        clientSecret: 'be865c2d10e4a71994120646ff80bdaef656b9be',
        repo: 'GoldSubmarine.github.io',
        owner: 'GoldSubmarine',
        admin: 'GoldSubmarine',
        id: md5(location.pathname),
        labels: 'Gitalk'.split(',').filter(l => l),
        perPage: 10,
        pagerDirection: 'last',
        createIssueManually: true,
        distractionFreeMode: false
      })
      gitalk.render('gitalk-container')

      mediumZoom(document.querySelectorAll("img"), { background: '#212530' })</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script></div><footer id="footer" class="footer"><div class="copyright"><span>© GoldSubmarine | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span></div></footer></div></body></html>